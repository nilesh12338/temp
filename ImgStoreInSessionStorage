<script>
document.addEventListener("DOMContentLoaded", function () {
    const imgElement = document.querySelector("img.for_updateProfile");

    if (!imgElement) return; // Exit if image element not found

    const sessionKey = "userProfileBase64";

    // Check if image base64 already in sessionStorage
    const cachedBase64 = sessionStorage.getItem(sessionKey);

    if (cachedBase64) {
        // Use base64 from sessionStorage
        imgElement.src = cachedBase64;
    } else {
        // Convert image to base64 and store
        const img = new Image();
        img.crossOrigin = "anonymous"; // Important to avoid CORS issues
        img.src = imgElement.src;

        img.onload = function () {
            const canvas = document.createElement("canvas");
            canvas.width = img.width;
            canvas.height = img.height;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);
            const base64String = canvas.toDataURL("image/png"); // or "image/jpeg"

            // Store in sessionStorage
            sessionStorage.setItem(sessionKey, base64String);

            // Set the base64 to actual image
            imgElement.src = base64String;
        };

        img.onerror = function () {
            console.warn("Could not load image to convert to base64.");
        };
    }
});
</script>

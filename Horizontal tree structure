<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LLMS Horizontal Tree</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <style>
    .tree-container {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      gap: 1rem;
      overflow-x: auto;
      padding: 1rem;
    }
    .tree-column {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      min-width: 250px;
      transition: all 0.3s ease-in-out;
    }
    .branch-scroll {
      max-height: 400px;
      overflow-y: auto;
    }
    .tree-card {
      border-left: 5px solid #007bff;
      background-color: #f8f9fa;
    }
    .toggle-btn {
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .collapse.fade {
      transition: height 0.3s ease;
    }
    .collapse:not(.show) {
      display: block;
      height: 0;
      overflow: hidden;
      opacity: 0;
    }
    .collapse.show {
      height: auto;
      opacity: 1;
    }
  </style>
</head>
<body>
<div class="container-fluid">
  <h5 class="mt-3">LLMS User Details</h5>
  <div id="tree-root" class="tree-container"></div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const treeData = {
    circle: {
      name: "Mumbai Metro",
      networks: [
        {
          name: "Network 1",
          aos: [
            {
              name: "AO 1 - East Mumbai",
              rbos: [
                {
                  name: "RBO 1 - Navi Mumbai",
                  branches: Array.from({length: 20}, (_, i) => ({
                    name: `Konkan Bhawan Branch ${i + 1}`,
                    incumbency: "",
                    cpc: "",
                    aes: ""
                  }))
                }
              ]
            }
          ]
        },
        {
          name: "Network 2",
          aos: []
        }
      ]
    }
  };

  function createCard(title, btnLabel, collapseId) {
    return `
      <div class="card p-2 tree-card">
        <div><strong>${title}</strong></div>
        ${btnLabel ? `
          <button
            class="btn btn-outline-primary btn-sm mt-2 toggle-btn"
            data-bs-toggle="collapse"
            data-bs-target="#${collapseId}"
            aria-expanded="false"
            aria-controls="${collapseId}"
          >
            <i class="bi bi-caret-down-fill"></i> ${btnLabel}
          </button>` : ''}
      </div>
    `;
  }

  function renderTree(data) {
    const $root = $('#tree-root');

    const $circleCol = $('<div class="tree-column"></div>');
    $circleCol.append(createCard(data.circle.name, 'View AOs', 'networksCollapse'));
    $root.append($circleCol);

    const $networkCol = $('<div class="tree-column collapse fade" id="networksCollapse"></div>');
    data.circle.networks.forEach((net, ni) => {
      const netCollapseId = `aoCollapse${ni}`;
      $networkCol.append(createCard(net.name, 'View AOs', netCollapseId));

      const $aoCol = $(`<div class="tree-column collapse fade" id="${netCollapseId}"></div>`);
      net.aos.forEach((ao, ai) => {
        const aoCollapseId = `rboCollapse${ni}${ai}`;
        $aoCol.append(createCard(ao.name, 'View RBOs', aoCollapseId));

        const $rboCol = $(`<div class="tree-column collapse fade" id="${aoCollapseId}"></div>`);
        ao.rbos.forEach((rbo, ri) => {
          const rboCollapseId = `branchCollapse${ni}${ai}${ri}`;
          $rboCol.append(createCard(rbo.name, 'View Branch', rboCollapseId));

          const $branchCol = $(`<div class="tree-column collapse fade branch-scroll" id="${rboCollapseId}"></div>`);
          rbo.branches.forEach(branch => {
            const branchCard = `
              <div class="card p-2 tree-card">
                <div><strong>${branch.name}</strong></div>
                <div class="small text-muted">
                  Incumbency: ${branch.incumbency || '-'}<br>
                  Linked CPC: ${branch.cpc || '-'}<br>
                  No. of A/Es: ${branch.aes || '-'}
                </div>
                <button class="btn btn-info btn-sm mt-2">User List</button>
              </div>`;
            $branchCol.append(branchCard);
          });
          $root.append($branchCol);
        });
        $root.append($rboCol);
      });
      $root.append($aoCol);
    });
    $root.append($networkCol);
  }

  $(document).ready(function () {
    requestIdleCallback(() => renderTree(treeData));
  });
</script>
</body>
</html>
